<h3>Übermäßige Anzahl Zugriffe auf Cache-Buffer</h3>
Zugriffe auf DB-Blöcke im Cache der DB (db-block-gets, consistent reads) werden dann kritisch hinsichtlich des provozierens von 'cache buffers chains'-Latchwaits wenn:<br/>
- in massiver Häufigkeit auf einige wenige Blöcke lesend oder schreibend zugegriffen wird (HotBlocks im Buffer-Cache)<br/>
- exorbitant viele Blöcke gelesen werden (kritsch selbst dann wenn diese weit verteilt im Cache liegen und keine HotBlocks bilden)<br/>
Für beide Konstellationen lassen sich problematische Statements identifizieren durch Bewertung nach der Spitze der Anzahl Blockzugriffe zwischen zwei AWR-Snapshots.<br/>
<pre style='background-color: #FFFFCC;'>SELECT /* DB-Tools Ramm CacheBuffer */ * FROM (
                      SELECT /*+ USE_NL(s t) */ s.*, SUBSTR(t.SQL_Text,1,600) "SQL-Text"
                      FROM (
                               SELECT /*+ NO_MERGE ORDERED */ s.SQL_ID, s.Instance_number "Instance",
                                      NVL(MIN(Parsing_Schema_Name), '[UNKNOWN]') "UserName", /* sollte immer gleich sein in Gruppe */
                                      MAX(Buffer_Gets_Delta)                                         "max. BufferGets betw.snapshots",
                                      SUM(Executions_Delta)                                          "Executions",
                                      ROUND(SUM(Elapsed_Time_Delta)/1000000)                         "Elapsed Time (Sec)",
                                      ROUND(SUM(ELAPSED_TIME_Delta/1000000) / DECODE(SUM(EXECUTIONS_Delta),
                                          0, 1, SUM(EXECUTIONS_Delta)),2)                            "Elapsed Time per Execute (Sec)",
                                      ROUND(SUM(CPU_Time_Delta)/1000000)                             "CPU-Time (Secs)",
                                      SUM(Disk_Reads_Delta)                                          "Disk Reads",
                                      ROUND(SUM(DISK_READS_delta) / DECODE(SUM(EXECUTIONS_Delta),
                                          0, 1, SUM(EXECUTIONS_Delta)),2)                            "Disk Reads per Execute",
                                      ROUND(SUM(Executions_Delta) / DECODE(SUM(Disk_Reads_Delta),
                                          0, 1, SUM(Disk_Reads_Delta)),8)                            "Executions per Disk Read",
                                      SUM(Buffer_Gets_Delta)                                         "Buffer Gets",
                                      ROUND(SUM(BUFFER_GETS_delta) / DECODE(SUM(EXECUTIONS_Delta),
                                          0, 1, SUM(EXECUTIONS_delta)),2)                            "Buffer Gets per Execution",
                                      ROUND(SUM(BUFFER_GETS_delta) / DECODE(SUM(Rows_Processed_Delta),
                                          0, 1, SUM(Rows_Processed_Delta)),2)                        "Buffer Gets per Result-Row",
                                      SUM(Rows_Processed_Delta)                                      "Rows Processed",
                                      ROUND(SUM(Rows_Processed_Delta) / DECODE(SUM(EXECUTIONS_Delta),
                                          0, 1, SUM(EXECUTIONS_Delta)),2)                            "Rows Processed per Execute",
                                      SUM(ClWait_Delta)/1000000                                      "Cluster Wait-Time (Sec)",
                                      SUM(IOWait_Delta)/1000000                                      "I/O Wait-Time (Sec)",
                                      SUM(CCWait_Delta)/1000000                                      "Concurrency Wait-Time (Sec)",
                                      SUM(PLSExec_Time_Delta)/1000000                                "PL/SQL Wait-Time (Sec)",
                                      s.DBID
                               FROM   dba_hist_snapshot snap,
                                      DBA_Hist_SQLStat s
                               WHERE  snap.Snap_ID = s.Snap_ID
                               AND    snap.DBID                = s.DBID
                               AND    snap.Instance_Number     = s.instance_number
                               AND    snap.Begin_Interval_time > SYSDATE - :P1
                               GROUP BY s.DBID, s.SQL_ID, s.Instance_number
                               HAVING MAX(Buffer_Gets_Delta) IS NOT NULL
                               ) s,
                               DBA_Hist_SQLText t
                      WHERE  t.DBID   = s.DBID
                      AND    t.SQL_ID = s.SQL_ID
                      ORDER BY "max. BufferGets betw.snapshots" DESC NULLS LAST
                      ) WHERE RowNum<:P2</pre><div>Parameter :P1: Number of days in history backward from now for consideration</div><div>Parameter :P2: Maximale Anzahl Rows für Aufnahme in Selektion</div>